{"componentChunkName":"component---src-templates-blog-post-js","path":"/postgresql-duplicate-key-value-violates/","result":{"data":{"site":{"siteMetadata":{"title":"ソタのほほん地下貯蔵庫"}},"markdownRemark":{"id":"1e9d70c8-04a1-57fc-a96d-1e68c4bc4328","excerpt":"これなに HerokuにLaravelを動作させるとCSVインポート機能で複数レコードを一気に登録後、個別でレコードを登録するタイミングでエラーになったので備忘録。 （ローカルの開発環境ではMySQLで動かしてたけど、公開する際は無料枠のあるHerokuを利用してたとき、HerokuはデフォルトでPostgreSQL…","html":"<h2>これなに</h2>\n<p>HerokuにLaravelを動作させるとCSVインポート機能で複数レコードを一気に登録後、個別でレコードを登録するタイミングでエラーになったので備忘録。</p>\n<p>（ローカルの開発環境ではMySQLで動かしてたけど、公開する際は無料枠のあるHerokuを利用してたとき、HerokuはデフォルトでPostgreSQLなので、そのタイミングでローカル（MySQL）では出ないエラーを吐いてた）</p>\n<h2>エラー内容</h2>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">SQLSTATE[23505]: Unique violation: 7 ERROR: duplicate key value violates unique constraint &quot;hoge_pkey&quot;</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>　</p>\n<h3>関連記事</h3>\n<ul>\n<li><a href=\"https://qiita.com/hanlio/items/abdd50808e77c3e697a0\">PostgreSQLに新規登録しようとしたら、「duplicate key value violates unique constraint」と怒られた。</a></li>\n<li><a href=\"https://www.xmisao.com/2014/06/07/duplicate-key-value-violates-unique-constant-primary-key-on-postgresql.html\">PostgreSQLでINSERT時に自動採番の主キーが重複してエラーが出る場合の対処法</a></li>\n</ul>\n<h2>原因</h2>\n<p>⬆️のタイトル通りだけど、自動採番のキー番号と実際のidがズレてしまうので発生していた</p>\n<h2>解決方法</h2>\n<p>関連記事では</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-text line-numbers\"><code class=\"language-text\">SELECT setval(&#39;hoge_id_seq&#39;, (SELECT MAX(id) FROM table));</code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span></span></pre></div>\n<p>で自動採番を動かしている、これでもいけるけど根本解決にはなっていなかったので、別の方法考えたい</p>\n<p>　</p>\n<h3>結論</h3>\n<p>insert時にcsvで渡ってきたidを指定して登録しちゃってたため、PostgreSQL内部のオートインクリメント（自動採番）が動かずidと乖離が起きてしまいエラーが発生していたっぽい。</p>\n<p>特に困らなかったのでid指定のinsertをやめて解決。</p>","frontmatter":{"title":"PostgreSQLへCSV入稿したあと単品でレコード登録するときに『duplicate key value violates unique constraint “hoge_pkey”』って怒られたときの備忘録","date":"May 27, 2022","description":"PostgreSQLへCSV入稿したあと単品でレコード登録するときに『duplicate key value violates unique constraint “hoge_pkey”』って怒られたときの備忘録","hero":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACRklEQVQoz1VTW28SYRDdP+Zf8BKbaLnfF1jaJjWamJhoqjFNTHwwtWCpQkFAoFxlwb4Y4yUaWouNthYUqoC22AoVpPp2dGYp2ofJ7PfNfHPOnJkVJLkHV/4nyEu5H5ByXfbOh/uKZTtwZNpHzkqekmPxlWD2PINtYY3vBL1/HVpvCcbAJjR3lmHwr8McrvEd+dGZFzg9LcMarcPg34Bq9hVM9z8wsCPbxpnLfhy/MAvrzRSkbBuCJVrnZGusAdviV1ijDTizbT6TmUNVmEIfOSYmdpScWBOOzHc4c104/SvQXLkL0fOEuxRGbixBN7/GqFRM8XX2J6+lcGIqAa13Fbr5N9zFodniTUhyF65CH2KkCntyRylIbdnTuwriQCdqhXSzp74xW45lO7CnduFI7w1zD3X8X3dBdfvlUBdjsKLoGaxA7SnCFv8CY7DMd3rfO1ginzhPf+8t6J0pWIEpWIbOt4FRd5FjAiGLiW0FeYBORsWIETEkpvZkC2KydZRdrgsx18dEoo7xZJPPgnZuFcZAmasbFt7DEtliLWiimrnXHCPN1O4iF6cBiYvbkGjVUi1MRsuYcqdx0fcc9sIvCMSCHpvDVWZCmtJQiI05ssXfas/yYK1WeHA0DAK1xZpQzTzGVU/8X0HLg888RdKJ2JFWxIoAFF/DqesZnL31FLQRvINyDxP5HkZCDRwTvZi+NIvz4RIcch8CoY0VDnj8vAb5/vDPIe+Sexhf+o2xRwfsXfneUEMx28FkYBPnwjU4c/uQ/k75DyRUgo7PJqWYAAAAAElFTkSuQmCC","aspectRatio":1.9047619047619047,"src":"/static/6b568cedd0e26fdf9da69e81cf27d6db/f3583/thumbnail.png","srcSet":"/static/6b568cedd0e26fdf9da69e81cf27d6db/dd5bb/thumbnail.png 320w,\n/static/6b568cedd0e26fdf9da69e81cf27d6db/f3dec/thumbnail.png 640w,\n/static/6b568cedd0e26fdf9da69e81cf27d6db/f3583/thumbnail.png 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}},"publicURL":"/static/6b568cedd0e26fdf9da69e81cf27d6db/thumbnail.png"},"tags":["Tech","備忘録","PostgreSQL","Laravel","Heroku"]}}},"pageContext":{"slug":"/postgresql-duplicate-key-value-violates/","previous":{"fields":{"slug":"/get-better-light-color-code/"},"frontmatter":{"title":"デザイナーじゃなくてもHSVを抑えればお洒落な色を作れる！"}},"next":null}},"staticQueryHashes":["1324386404"]}