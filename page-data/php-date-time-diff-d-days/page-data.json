{"componentChunkName":"component---src-templates-blog-post-js","path":"/php-date-time-diff-d-days/","result":{"data":{"site":{"siteMetadata":{"title":"ソタのほほん地下貯蔵庫"}},"markdownRemark":{"id":"9aa162cf-f711-5d91-8784-66dc004beb43","excerpt":"これなに 日数差を取得する際に  が返却する DateIntervalの  プロパティと  プロパティを利用する方法があります。 結論、daysを利用するのが良いので、dがまずい理由を書いていきたいと思います。 「DateTime 差分 php…","html":"<h2>これなに</h2>\n<p>日数差を取得する際に <code class=\"language-text\">DateTime::diff()</code> が返却する <a href=\"https://www.php.net/manual/ja/class.dateinterval.php\">DateInterval</a>の <code class=\"language-text\">d</code> プロパティと <code class=\"language-text\">days</code> プロパティを利用する方法があります。</p>\n<p>結論、daysを利用するのが良いので、dがまずい理由を書いていきたいと思います。</p>\n<p>「DateTime 差分 php」でググると上位でヒットする<a href=\"https://www.sejuku.net/blog/21508\">こちら</a>の記事では <code class=\"language-text\">d</code> を用いる方法が紹介されているので注意が必要です。</p>\n<h3>dで問題ないパターン</h3>\n<p>現在時刻1月15日で30日後との差分を計算</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$currentDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-01-15'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$compareDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-02-14'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 1月15日の30日後</span>\n    \n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">d</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><em>出力結果</em></p>\n<p><code class=\"language-text\">30</code></p>\n<p>30となるので正常動作</p>\n<h3>dで問題あるパターン</h3>\n<p>現在時刻2月15日で30日後との差分を計算</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$currentDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-02-15'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$compareDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-03-17'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2月15日の30日後</span>\n    \n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">d</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><em>出力結果</em></p>\n<p><code class=\"language-text\">2</code></p>\n<p>30となってほしいところ、2となってしまう</p>\n<h2>なぜ</h2>\n<p>dプロパティを使うと比較月の1日からカウントを始めるため、2月1日から30日をカウントすると月が繰り上がってしまう</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$currentDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-02-15'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$compareDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-03-17'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2月15日の30日後</span>\n    \n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">m</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'ヶ月と'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">d</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'日'</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><em>出力結果</em></p>\n<p><code class=\"language-text\">1ヶ月と2日</code></p>\n<h4>ちなみに</h4>\n<p>27日前からは桁上がりが起こらない</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$currentDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-02-15'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$compareDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-03-14'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2月15日の27日後</span>\n    \n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">m</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'ヶ月と'</span> <span class=\"token operator\">.</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">d</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'日'</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span><span></span></span></pre></div>\n<p><em>出力結果</em></p>\n<p><code class=\"language-text\">0ヶ月と27日</code></p>\n<h2>対処法</h2>\n<p>基本 d ではなく days を利用する</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre style=\"counter-reset: linenumber NaN\" class=\"language-php line-numbers\"><code class=\"language-php\"><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span>\n    <span class=\"token variable\">$currentDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-02-15'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$compareDate</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">DateTime</span><span class=\"token punctuation\">(</span><span class=\"token string single-quoted-string\">'2021-03-17'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">// 2月15日の30日後</span>\n    <span class=\"token keyword\">echo</span> <span class=\"token variable\">$currentDate</span><span class=\"token operator\">-></span><span class=\"token function\">diff</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$compareDate</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-></span><span class=\"token property\">days</span><span class=\"token punctuation\">;</span></span></code><span aria-hidden=\"true\" class=\"line-numbers-rows\" style=\"white-space: normal; width: auto; left: 0;\"><span></span><span></span><span></span><span></span></span></pre></div>\n<p><em>出力結果</em></p>\n<p><code class=\"language-text\">30</code></p>\n<h2>あとがき</h2>\n<p>daysの方が比較もとの月の影響を受けず、dの上位互換と言えると思います。</p>","frontmatter":{"title":"【PHP】DateTime::diff()で日数差を取得するにはdaysプロパティを使う（dはダメ）","date":"September 17, 2021","description":"【PHP】DateTime::diff()で日数差を取得するにはdaysプロパティを使う（dはダメ）","hero":{"childImageSharp":{"fluid":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA7EAAAOxAGVKw4bAAACVElEQVQoz4WTy05TURSGzwM48hl8Hx/BoQMTRzpRo04wcWC8RI01gQQQjVyLLZTS1ENPSykttD29Uuj1tKUXoKe30xYwfmYfAk6MDP7sy9p77f9f/9pSLrCMvGShlN1gOEjT68TpdxP/RU+gE2fQT1OtepmZv89hRcboxpHsLx/x7sE9klEHp6MM3XbMPHwdurqKcXbA4awF+42b1Kde0zeSSLmIlacvxgjuOPn96wCjl2TQv8DQSJlrwUqMAkMjzaCfYiji53m64Tkat2/Rj61hjPaRCnkviZgT/+YCjVqQsuanWQ/RqIeoaH6Om7voJ1FaxxETpYKPWnWbbOYnlWqQatxG0f+ew6xMq6UiOR2TCMjurxTyCm7XDH7fPF7PLGpkhUTcid02TjLupFreQvF8JxpeYTuwREJ1kEq5KWo7KMocidgaUkeP0W6pFHKK+bKQ0xH16SUpFbzmXLAU49kwQ7sVRStuIu41aiH044gp/9IwSY2ushtaxvJpDOuixZSfSbspl/xsyN/Qij6y+zLra1MEA1Zc69O8ffOMSNiO2/XFJCISiQeEWZJgV2uq5HIKVW2Lo+YuJ0dhs46ClTion0TMxOXSpqmiWPCaTAXDtq5yPtozIYyU6s0AqzOvqO3ZGJ3vY3STV05fyjB6CUaD9JXDYi72R4M92vUd7LPjyIqDZiOMpOtRJp0PmbY9plLwm4mu60URN4wUB75FPNYpPlgmuHP3OUs/FpF6rQQLro98nnhCJGDj7PRvc//zl4ik3YuYlpepagrNRhS7w0os5uEPDf4CbhFSRsEAAAAASUVORK5CYII=","aspectRatio":1.9047619047619047,"src":"/static/14291f4f3d4fae12f3a97a8e7583a7f8/f3583/thumbnail.png","srcSet":"/static/14291f4f3d4fae12f3a97a8e7583a7f8/dd5bb/thumbnail.png 320w,\n/static/14291f4f3d4fae12f3a97a8e7583a7f8/f3dec/thumbnail.png 640w,\n/static/14291f4f3d4fae12f3a97a8e7583a7f8/f3583/thumbnail.png 1200w","sizes":"(max-width: 1200px) 100vw, 1200px"}},"publicURL":"/static/14291f4f3d4fae12f3a97a8e7583a7f8/thumbnail.png"},"tags":["Tech","PHP","Date"]}}},"pageContext":{"slug":"/php-date-time-diff-d-days/","previous":{"fields":{"slug":"/laravel-login-on-tinker/"},"frontmatter":{"title":"【Laravel】tinker上でログイン状態にしてAuthファサードからUserモデルを取得したい"}},"next":null}},"staticQueryHashes":["1324386404"]}